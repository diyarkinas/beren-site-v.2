<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Berenn â™¥</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap');
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    background:#000;
    overflow:hidden;
    height:100vh; 
    width:100vw;
    touch-action:manipulation;
    -webkit-tap-highlight-color:transparent;
    user-select:none;
    -webkit-user-select:none;
    position:fixed;
  }
  canvas { 
    display:block; 
    position:fixed; 
    top:0; 
    left:0;
    -webkit-transform:translateZ(0);
    transform:translateZ(0);
  }

  #tap-hint {
    position:fixed; 
    bottom:36px; 
    left:50%;
    transform:translateX(-50%);
    color:rgba(255,255,255,0.3);
    font-family:'Great Vibes',cursive;
    font-size:clamp(16px, 4vw, 20px);
    letter-spacing:1px;
    z-index:10; 
    pointer-events:none;
    opacity:0;
    animation:hintPulse 2.4s ease-in-out 4.5s infinite;
  }
  @keyframes hintPulse { 0%,100%{opacity:0} 50%{opacity:1} }
  
  #music-info {
    position:fixed; 
    top:24px; 
    left:50%;
    transform:translateX(-50%);
    color:rgba(255,255,255,0.5);
    font-family:'Great Vibes',cursive;
    font-size:clamp(14px, 3.5vw, 18px);
    z-index:10;
    pointer-events:none;
    opacity:0;
    transition: opacity 0.5s;
    white-space:nowrap;
  }
  #music-info.show { opacity:1; }
  
  @media (max-width: 768px) {
    #tap-hint { bottom:24px; }
    #music-info { top:16px; }
  }
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="tap-hint">ðŸ’œ ekrana dokunun</div>
<div id="music-info">â™ª Lord Huron - The Night We Met</div>
<script>
(function(){

// ============================================================
//  Lord Huron - The Night We Met (Real song)
// ============================================================
let audioElement = null;
let musicStarted = false;

function startMusic(){
  if(musicStarted) return;
  musicStarted=true;
  document.getElementById('music-info').classList.add('show');
  setTimeout(()=>{ document.getElementById('music-info').classList.remove('show'); },4500);
  
  // Create audio element for the real song
  audioElement = new Audio();
  audioElement.src = 'music.mp3'; // MP3 dosyasÄ± aynÄ± klasÃ¶rde olmalÄ±
  audioElement.currentTime = 30; // 30. saniyeden baÅŸlat
  audioElement.loop = true;
  audioElement.volume = 0.5;
  
  // Play the song
  audioElement.play().catch(e => {
    console.log('Audio autoplay blocked. Will play on user interaction.');
  });
}

// ============================================================
//  CANVAS (Mobile optimized)
// ============================================================
const canvas=document.getElementById('c');
const ctx=canvas.getContext('2d', { alpha: false });
let W,H;
let dpr = window.devicePixelRatio || 1;
// Limit DPR on mobile for performance
if(dpr > 2) dpr = 2;

function resize(){ 
  W=window.innerWidth; 
  H=window.innerHeight;
  canvas.width=W*dpr; 
  canvas.height=H*dpr;
  canvas.style.width=W+'px';
  canvas.style.height=H+'px';
  ctx.scale(dpr,dpr);
}
resize();
window.addEventListener('resize',()=>{ resize(); rebuildTextParticles(); });

// ============================================================
//  GENÄ°ÅžLETÄ°LMÄ°Åž RENKLER (16 farklÄ± renk paleti)
// ============================================================
const colorSets=[
  {p:'#e84393', t:'#fd79a8', bg:'rgba(232,67,147,0.035)'},   // hot pink
  {p:'#fd79a8', t:'#e84393', bg:'rgba(253,121,168,0.035)'},  // light pink
  {p:'#a29bfe', t:'#dfe6e9', bg:'rgba(162,155,254,0.04)'},   // lavender
  {p:'#6c5ce7', t:'#a29bfe', bg:'rgba(108,92,231,0.04)'},    // purple
  {p:'#00cec9', t:'#81ecec', bg:'rgba(0,206,201,0.035)'},    // cyan
  {p:'#e17055', t:'#fab1a0', bg:'rgba(225,112,85,0.035)'},   // coral
  {p:'#fdcb6e', t:'#ffeaa7', bg:'rgba(253,203,110,0.035)'},  // yellow
  {p:'#55efc4', t:'#dfe6e9', bg:'rgba(85,239,196,0.035)'},   // mint
  {p:'#ff7675', t:'#fab1a0', bg:'rgba(255,118,117,0.035)'},  // red
  {p:'#74b9ff', t:'#a29bfe', bg:'rgba(116,185,255,0.04)'},   // sky blue
  {p:'#fd79a8', t:'#fdcb6e', bg:'rgba(253,121,168,0.035)'},  // pink-yellow
  {p:'#e17055', t:'#fdcb6e', bg:'rgba(225,112,85,0.035)'},   // orange
  {p:'#00b894', t:'#55efc4', bg:'rgba(0,184,148,0.035)'},    // green
  {p:'#d63031', t:'#ff7675', bg:'rgba(214,48,49,0.035)'},    // deep red
  {p:'#0984e3', t:'#74b9ff', bg:'rgba(9,132,227,0.04)'},     // blue
  {p:'#6c5ce7', t:'#fd79a8', bg:'rgba(108,92,231,0.04)'},    // purple-pink
];
let colorIdx=0, cur=colorSets[0];
let bgCur='rgba(232,67,147,0.035)';
let bgTarget=bgCur;

// ============================================================
//  KALP FORMÃœL
// ============================================================
function heartPt(t,cx,cy,sz){
  const x=16*Math.pow(Math.sin(t),3);
  const y=-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t));
  return {x:cx+x*sz, y:cy+y*sz};
}
function getHeartTarget(){
  const sz=Math.min(W,H)*0.033;
  const layer=Math.random();
  const s=sz*(0.84+layer*0.16);
  const t=Math.random()*Math.PI*2;
  const pt=heartPt(t,W/2,H/2,s);
  const nx=Math.sin(t)*(layer-0.5)*6;
  const ny=Math.cos(t)*(layer-0.5)*6;
  return {x:pt.x+nx, y:pt.y+ny};
}

// ============================================================
//  KÃœÃ‡ÃœK KALP Ã‡IZICI
// ============================================================
function drawHeartShape(c,x,y,s){
  c.beginPath();
  c.moveTo(x, y+s*0.3);
  c.bezierCurveTo(x-s*1.1, y-s*0.6, x-s*1.1, y-s*1.5, x, y-s*0.6);
  c.bezierCurveTo(x+s*1.1, y-s*1.5, x+s*1.1, y-s*0.6, x, y+s*0.3);
  c.fill();
}

// ============================================================
//  BIG HEART PARTIKELLER
// ============================================================
// Mobile iÃ§in partikel sayÄ±sÄ±nÄ± optimize et
const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
const HEART_COUNT = isMobile ? 500 : 800;
let heartParticles=[];

class HeartParticle{
  constructor(init){
    this.size=1.8+Math.random()*3.6;
    this.alpha=0.45+Math.random()*0.55;
    this.speed=(0.02+Math.random()*0.04)*0.9;
    this.setTarget();
    if(init){
      const a=Math.random()*Math.PI*2;
      const d=Math.max(W,H)*1.5;
      this.x=W/2+Math.cos(a)*d;
      this.y=H/2+Math.sin(a)*d;
    } else { this.x=this.tx; this.y=this.ty; }
  }
  setTarget(){ const tg=getHeartTarget(); this.tx=tg.x; this.ty=tg.y; }
  scatter(){
    const a=Math.random()*Math.PI*2;
    const d=90+Math.random()*240;
    this.tx=this.x+Math.cos(a)*d;
    this.ty=this.y+Math.sin(a)*d;
  }
  reform(){ this.setTarget(); }
  update(){ this.x+=(this.tx-this.x)*this.speed; this.y+=(this.ty-this.y)*this.speed; }
  draw(){
    ctx.save();
    ctx.globalAlpha=this.alpha;
    ctx.fillStyle=cur.p;
    ctx.shadowColor=cur.p;
    ctx.shadowBlur=7;
    drawHeartShape(ctx,this.x,this.y,this.size);
    ctx.restore();
  }
}

for(let i=0;i<HEART_COUNT;i++) heartParticles.push(new HeartParticle(true));

// ============================================================
//  TEXT PARTICLE SISTEMI (AKICI INTRO Ä°Ã‡Ä°N GELÄ°ÅžTÄ°RÄ°LMÄ°Åž)
// ============================================================
let textParticles=[];
let textTargets=[];
let fontReady=false;

document.fonts.ready.then(()=>{ fontReady=true; rebuildTextParticles(); });

function sampleTextPixels(){
  const fontSize=Math.min(W,H)*0.11;
  const oc=document.createElement('canvas');
  oc.width=W; oc.height=H;
  const ox=oc.getContext('2d');

  ox.clearRect(0,0,W,H);
  ox.font=`700 ${fontSize}px 'Great Vibes', cursive`;
  ox.textAlign='center';
  ox.textBaseline='middle';
  ox.fillStyle='#fff';
  ox.fillText('Berenn', W/2, H/2);

  const imgData=ox.getImageData(0,0,W,H);
  const d=imgData.data;
  const pts=[];
  const step=isMobile ? 4 : 3;
  for(let y=0;y<H;y+=step){
    for(let x=0;x<W;x+=step){
      const idx=(y*W+x)*4;
      if(d[idx+3]>80){
        pts.push({x,y});
      }
    }
  }
  return pts;
}

function rebuildTextParticles(){
  if(!fontReady) return;
  textTargets=sampleTextPixels();

  const need=textTargets.length;
  while(textParticles.length<need){
    textParticles.push(new TextParticle(true));
  }
  textParticles.length=need;
  textParticles.forEach((p,i)=>{
    p.homeX=textTargets[i].x;
    p.homeY=textTargets[i].y;
    p.setIntroTarget(); // Ä°ntro iÃ§in Ã¶zel baÅŸlangÄ±Ã§ pozisyonu
  });
}

class TextParticle{
  constructor(init){
    this.size=1.2+Math.random()*2.2;
    this.alpha=0.55+Math.random()*0.45;
    this.speed=(0.028+Math.random()*0.038)*0.9;
    this.homeX=W/2; 
    this.homeY=H/2;
    this.tx=this.homeX; 
    this.ty=this.homeY;
    // BaÅŸlangÄ±Ã§ta Ã§ok yukarÄ±da
    this.x=W/2+(Math.random()-0.5)*W*0.01;
    this.y=-400-Math.random()*500;
    this.introPhase=0; // 0=falling, 1=landed, 2=teleporting
    this.landY=0; // Ä°niÅŸ noktasÄ±
  }
  setIntroTarget(){
    // Ä°lk iniÅŸ noktasÄ±: ekranÄ±n ortasÄ±nÄ±n biraz Ã¼stÃ¼
    this.landY=H*0.38 + (Math.random()-0.5)*H*0.08;
    this.tx=this.homeX+(Math.random()-0.5)*60;
    this.ty=this.landY;
    this.introPhase=0;
  }
  setTarget(){ 
    this.tx=this.homeX; 
    this.ty=this.homeY; 
  }
  scatter(){
    const a=Math.random()*Math.PI*2;
    const d=60+Math.random()*180;
    this.tx=this.x+Math.cos(a)*d;
    this.ty=this.y+Math.sin(a)*d;
  }
  reform(){ this.setTarget(); }
  update(){ 
    this.x+=(this.tx-this.x)*this.speed; 
    this.y+=(this.ty-this.y)*this.speed; 
  }
  draw(){
    ctx.save();
    ctx.globalAlpha=this.alpha;
    ctx.fillStyle=cur.t;
    ctx.shadowColor=cur.t;
    ctx.shadowBlur=5;
    drawHeartShape(ctx,this.x,this.y,this.size);
    ctx.restore();
  }
}

// ============================================================
//  BURST PARTIKELLER
// ============================================================
let bursts=[];
class BurstP{
  constructor(x,y,col){
    this.x=x; this.y=y; this.col=col;
    const a=Math.random()*Math.PI*2;
    const sp=(2+Math.random()*4.5)*0.9;
    this.vx=Math.cos(a)*sp; this.vy=Math.sin(a)*sp;
    this.life=1; this.decay=(0.01+Math.random()*0.016)*0.9;
    this.size=2+Math.random()*3;
  }
  update(){ this.x+=this.vx; this.y+=this.vy; this.vy+=0.04; this.life-=this.decay; }
  draw(){
    if(this.life<=0) return;
    ctx.save();
    ctx.globalAlpha=this.life*0.8;
    ctx.fillStyle=this.col;
    ctx.shadowColor=this.col;
    ctx.shadowBlur=6;
    drawHeartShape(ctx,this.x,this.y,this.size*this.life);
    ctx.restore();
  }
}
function spawnBurst(cx,cy,count){
  const burstCount = isMobile ? Math.floor(count*0.6) : count; // Mobile'da daha az burst
  for(let i=0;i<burstCount;i++) bursts.push(new BurstP(cx,cy,cur.p));
}

// ============================================================
//  GELÄ°ÅžTÄ°RÄ°LMÄ°Åž INTRO: YumuÅŸak iniÅŸ â†’ IÅŸÄ±nlanma
// ============================================================
let introDone=false;
let introPhase='falling'; // 'falling' â†’ 'preparing' â†’ 'teleporting' â†’ 'done'
let introTimer=0;
const INTRO_FALL_DURATION=1800; // Ä°niÅŸ sÃ¼resi
const INTRO_PAUSE_DURATION=400; // Ä°ndikten sonra bekleme
const INTRO_TELEPORT_DURATION=800; // IÅŸÄ±nlanma sÃ¼resi

function processIntro(now){
  if(introDone) return;
  
  if(introPhase==='falling'){
    // Partikeller iniyor
    if(now>INTRO_FALL_DURATION){
      introPhase='preparing';
      introTimer=now;
      // Ä°ndikten sonra burst efekti
      const burstPoints=[];
      for(let i=0;i<textParticles.length;i+=Math.floor(textParticles.length/8)){
        if(textParticles[i]){
          burstPoints.push({x:textParticles[i].x, y:textParticles[i].y});
        }
      }
      burstPoints.forEach(pt=>spawnBurst(pt.x,pt.y,12));
    }
  }
  else if(introPhase==='preparing'){
    // Ä°ndikten sonra kÄ±sa bekleme
    if(now-introTimer>INTRO_PAUSE_DURATION){
      introPhase='teleporting';
      introTimer=now;
      // TÃ¼m partikelleri final pozisyonlarÄ±na yÃ¶nlendir
      textParticles.forEach(p=>{
        p.tx=p.homeX;
        p.ty=p.homeY;
        p.speed=(0.045+Math.random()*0.055); // IÅŸÄ±nlanma iÃ§in hÄ±zlÄ± geÃ§iÅŸ
      });
      // Final pozisyonlarda burst
      setTimeout(()=>{
        const finalBursts=[];
        for(let i=0;i<textParticles.length;i+=Math.floor(textParticles.length/10)){
          if(textParticles[i]){
            finalBursts.push({x:textParticles[i].homeX, y:textParticles[i].homeY});
          }
        }
        finalBursts.forEach(pt=>spawnBurst(pt.x,pt.y,15));
      },200);
    }
  }
  else if(introPhase==='teleporting'){
    // IÅŸÄ±nlanma animasyonu
    if(now-introTimer>INTRO_TELEPORT_DURATION){
      introPhase='done';
      introDone=true;
      // HÄ±zÄ± normale dÃ¶ndÃ¼r
      textParticles.forEach(p=>{
        p.speed=(0.028+Math.random()*0.038)*0.9;
      });
    }
  }
}

// ============================================================
//  TAP â†’ OPTIMIZE EDÄ°LMÄ°Åž
// ============================================================
let tapLocked=false;
let isScattering=false;

function onTap(e){
  e.preventDefault();
  startMusic();
  if(tapLocked || isScattering || !introDone) return; // Ä°ntro bitene kadar tap yasak
  tapLocked=true;
  isScattering=true;

  const scatterBatchSize = isMobile ? 30 : 50;
  
  let scatteredHeart=0;
  let scatteredText=0;
  
  function scatterBatch(){
    for(let i=0; i<scatterBatchSize && scatteredHeart<heartParticles.length; i++){
      heartParticles[scatteredHeart++].scatter();
    }
    for(let i=0; i<scatterBatchSize && scatteredText<textParticles.length; i++){
      textParticles[scatteredText++].scatter();
    }
    
    if(scatteredHeart<heartParticles.length || scatteredText<textParticles.length){
      requestAnimationFrame(scatterBatch);
    } else {
      isScattering=false;
    }
  }
  scatterBatch();

  setTimeout(()=>{
    colorIdx=(colorIdx+1)%colorSets.length;
    cur=colorSets[colorIdx];
    bgTarget=cur.bg;
    
    let reformedHeart=0;
    let reformedText=0;
    
    function reformBatch(){
      for(let i=0; i<scatterBatchSize && reformedHeart<heartParticles.length; i++){
        heartParticles[reformedHeart++].reform();
      }
      for(let i=0; i<scatterBatchSize && reformedText<textParticles.length; i++){
        textParticles[reformedText++].reform();
      }
      
      if(reformedHeart<heartParticles.length || reformedText<textParticles.length){
        requestAnimationFrame(reformBatch);
      }
    }
    reformBatch();
    
    setTimeout(()=>{ tapLocked=false; },1200);
  },750);
}
canvas.addEventListener('click',onTap);
canvas.addEventListener('touchstart',onTap,{passive:false});

// ============================================================
//  BG RENK GEÃ‡IÅžI
// ============================================================
let bgAlpha=0;
let bgFrom=[0,0,0,0];
let bgTo=[232,67,147,0.035];

function parseBg(str){
  const m=str.match(/[\d.]+/g);
  return m ? m.map(Number) : [0,0,0,0];
}
function lerp(a,b,t){ return a+(b-a)*t; }

// ============================================================
//  ANA LOOP (Mobile optimized)
// ============================================================
let lastFrameTime=0;
const targetFPS = isMobile ? 50 : 60; // Mobile'da biraz dÃ¼ÅŸÃ¼k FPS
const frameInterval=1000/targetFPS;

function animate(now){
  // Frame rate control
  if(now-lastFrameTime<frameInterval){
    requestAnimationFrame(animate);
    return;
  }
  lastFrameTime=now;

  // --- BG ---
  bgTo=parseBg(bgTarget);
  bgAlpha=Math.min(1, bgAlpha+0.015);
  const r=Math.round(lerp(bgFrom[0],bgTo[0],bgAlpha));
  const g=Math.round(lerp(bgFrom[1],bgTo[1],bgAlpha));
  const b=Math.round(lerp(bgFrom[2],bgTo[2],bgAlpha));
  const a=lerp(bgFrom[3],bgTo[3],bgAlpha).toFixed(3);
  if(bgAlpha>=1){ bgFrom=bgTo.slice(); bgAlpha=0; }

  ctx.clearRect(0,0,W,H);
  ctx.fillStyle=`rgba(${r},${g},${b},${a})`;
  ctx.fillRect(0,0,W,H);

  // intro
  processIntro(now);

  // bursts
  const maxBursts = isMobile ? 80 : 100;
  let burstCount=0;
  for(let i=bursts.length-1;i>=0 && burstCount<maxBursts;i--){
    bursts[i].update(); 
    bursts[i].draw();
    burstCount++;
    if(bursts[i].life<=0) bursts.splice(i,1);
  }

  // big heart
  heartParticles.forEach(p=>{ p.update(); p.draw(); });

  // text particles
  textParticles.forEach(p=>{ p.update(); p.draw(); });

  requestAnimationFrame(animate);
}
requestAnimationFrame(animate);

})();
</script>
</body>
</html>
